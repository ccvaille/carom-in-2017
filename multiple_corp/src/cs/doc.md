# 网站客服前端技术文档
## 1 架构设计

### 1.1 开发环境
前端本地环境开发（webpackDevServer）
接口联调时需要后端配置允许 **static.workec.com** 域名跨域

### 1.2 技术选型
1. 客服管理后台 react + redux
2. ec内嵌客服页面 react + redux
3. 访客端js sdk es6 -> ie8加载es3 polyfill
4. 访客端弹窗聊天窗口 -> react + redux
4. 样式 less

### 1.3 目录结构
1. 客服管理后台放在biz目录下，域名biz.workec.com
2. ec内嵌客服放在cs目录下，域名kf.workec.com
3. sdk代码放在cs目录下，域名kf.ecqun.com

## 2 消息协议

### 2.1 心跳
1. ec客户端内嵌页面全部走websocket通道
2. 访客端走http长轮询

### 2.2 邀请消息（及其他通知）
1. ec客户端内嵌页面全部走websocket通道
2. 访客端走http长轮询

## 3 自定义消息
自定义消息通过腾讯IM的管理员账号进行转发（广播）

### 3.1 状态变更

#### 3.1.1 访客状态变更
广播给该企业的所有客服

* 访客访问页面 -> **访客在线**
* 访客收到邀请 -> **访客接受邀请中**（后端）
* 访客接受邀请 -> **访客会话中**
* 访客 拒绝 / 不接受邀请 -> **访客在线**
* 访客主动会话 -> **访客会话中**
* 访客关闭会话 -> **访客结束会话**
* 访客关闭会话后其他所有页面 -> **访客在线**
* 访客会话超时 -> **访客在线（系统结束会话）**
* 访客关闭页面 -> **访客离线**

### 3.1.2 客服状态变更
广播给客服当前接待的访客

* 客服登录ec客户端 -> **客服在线**
* 客服退出ec客户端 -> **客服离线**

### 3.2 系统消息
#### 3.2.1 心跳消息
1. 访客端http请求
2. 客服端websocket消息

#### 3.2.2 系统通知
腾讯IM自定义消息，各个消息具体格式约定见Server端文档

## 4 历史消息
1. 客服经理查看下属客服聊天记录：从php获取（非实时）
2. 其他情况下直接从腾讯IM拉取

## 5 任务分解
1. 客服管理后台（李彬）
2. ec客户端客服内嵌页面（杨文道、李彬）
3. 前端js sdk （杨文道）
4. 样式开发（丁春艳）
